<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.organOld.dao.repository.OldmanKeyDao">

    <resultMap id="oldmanKey" type="com.organOld.dao.entity.oldman.OldmanKey">
        <id property="oldmanId" column="id" />
        <result property="birthday" column="birthday"/>
        <result property="familyIndex" column="family_index" />
        <result property="economicIndex" column="economic_index" />
        <result property="floor" column="floor" />
        <result property="isActivityOrgan" column="isActivityOrgan" />
        <result property="chxIndex" column="chx_index" />
        <result property="intelligence" column="intelligence" />
        <result property="eyesight" column="eyesight" />
        <result property="keyStatus" column="key_status" />
        <collection property="healthSelectIdsList" ofType="com.organOld.dao.entity.oldman.HealthSelect">
            <id property="id" column="hsid" />
            <id property="firType" column="fir_type" />
        </collection>
    </resultMap>

    <select id="getByPage" parameterType="com.organOld.dao.util.Page" resultType="com.organOld.dao.entity.oldman.Oldman">
        SELECT ob.id,ob.name,ob.goal
        FROM oldman_base ob,organ org,auto_value x
        WHERE x.id=ob.xq_id AND org.id=x.parent_index AND ob.goal > ${entity.keyGoalBase}
        <if test="entity!=null and entity.jwId!=null and entity.jwId!=0">
            and org.id=#{entity.jwId}
        </if>
        ORDER BY ${sortType} ${sort}
        limit #{start},#{length}
    </select>

    <select id="getSizeByPage" parameterType="com.organOld.dao.util.Page" resultType="java.lang.Long">
        SELECT count(1)
        FROM oldman_base ob,organ org,auto_value x
        WHERE x.id=ob.xq_id AND org.id=x.parent_index AND ob.goal > ${entity.keyGoalBase}
        <if test="entity!=null and entity.jwId!=null and entity.jwId!=0">
            and org.id=#{entity.jwId}
        </if>
    </select>


    <select id="getAllOldmanKey" resultMap="oldmanKey">
        SELECT ob.id,ob.key_status,ob.birthday,ob.floor,oe.economic_index,oldf.family_index,ohb.intelligence,ohb.eyesight,ho.home_id,hs.id hsid,hs.fir_type
        FROM oldman_base ob left join home_oldman ho on ob.id=ho.oldman_id left join home h on ho.home_id=h.id and h.fir_type=2
		  left join health_select_oldman hso on hso.oldman_id=ob.id left join health_select hs on hs.id=hso.health_select_id and hs.fir_type in (1,2),
		  oldman_economic oe,oldman_family oldf,oldman_health_base ohb
        where ob.id=oe.oldman_id and ob.id=oldf.oldman_id and ob.id=ohb.oldman_id
    </select>


    <select id="getOldmanKeyByRound" resultMap="oldmanKey"  parameterType="com.organOld.dao.util.Page">
        SELECT ob.id,ob.key_status,ob.birthday,ob.floor,oe.economic_index,oldf.family_index,ohb.intelligence,ohb.eyesight,ho.home_id,hs.id hsid,hs.fir_type
        FROM oldman_base ob left join home_oldman ho on ob.id=ho.oldman_id left join home h on ho.home_id=h.id and h.fir_type=2
        left join health_select_oldman hso on hso.oldman_id=ob.id left join health_select hs on hs.id=hso.health_select_id and hs.fir_type in (1,2),
        oldman_economic oe,oldman_family oldf,oldman_health_base ohb
        where ob.id=oe.oldman_id and ob.id=oldf.oldman_id and ob.id=ohb.oldman_id AND ob.id>${current}
        limit 0,#{round}
    </select>
</mapper>
